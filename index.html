<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ù–°–ñ ‚Äî Pro Life Fit</title>
    <style>
        :root {
            --bg: #E4E9F2;
            --surface: #E4E9F2;
            --text-main: #3a4a5c;
            --text-light: #8494a7;
            --accent: #4361ee;
            --accent-hover: #3451d1;
            --accent-green: #10b981;
            --accent-sky: #38bdf8;
            --accent-purple: #8b5cf6;

            --shadow-out: 6px 6px 12px rgba(163,177,198,0.5), -6px -6px 12px rgba(255,255,255,0.8);
            --shadow-out-sm: 3px 3px 6px rgba(163,177,198,0.45), -3px -3px 6px rgba(255,255,255,0.75);
            --shadow-in: inset 3px 3px 6px rgba(163,177,198,0.45), inset -3px -3px 6px rgba(255,255,255,0.75);
            --shadow-hover: 8px 8px 16px rgba(163,177,198,0.55), -8px -8px 16px rgba(255,255,255,0.9);
            --shadow-btn: 4px 4px 8px rgba(163,177,198,0.5), -4px -4px 8px rgba(255,255,255,0.85);
            --shadow-btn-press: inset 2px 2px 5px rgba(163,177,198,0.5), inset -2px -2px 5px rgba(255,255,255,0.7);

            --radius: 20px;
            --radius-sm: 14px;
            --radius-xs: 10px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            font-size: 14px;
            line-height: 1.5;
        }

        .header {
            background: var(--surface);
            padding: 18px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(163,177,198,0.3);
            position: relative;
            z-index: 100;
        }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .logo-pill {
            background: #ffffff;
            border-radius: 14px;
            padding: 6px 14px;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow-out-sm);
        }
        .logo-pill img { height: 36px; width: auto; display: block; }
        .header-right { text-align: right; }
        .header-right h1 {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--accent), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header-right .subtitle {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .container {
            display: grid;
            grid-template-columns: 500px 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
            align-items: start;
        }

        .panel-left {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow-out);
            overflow-y: auto;
            max-height: calc(100vh - 120px);
            position: sticky;
            top: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 12px;
        }

        .section-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-light);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid rgba(163,177,198,0.2);
        }

        .form-group { margin-bottom: 14px; }
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 5px;
        }
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: none;
            border-radius: var(--radius-xs);
            font-size: 14px;
            background: var(--surface);
            box-shadow: var(--shadow-in);
            color: var(--text-main);
            transition: box-shadow 0.2s;
            outline: none;
        }
        .form-group input[type="date"]:focus,
        .form-group select:focus {
            box-shadow: var(--shadow-in), 0 0 0 2px rgba(67,97,238,0.25);
        }

        .radio-group { display: flex; gap: 8px; margin-top: 4px; }
        .radio-pill { flex: 1; position: relative; }
        .radio-pill input { display: none; }
        .radio-pill label {
            display: block;
            text-align: center;
            padding: 9px 12px;
            border-radius: var(--radius-xs);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            background: var(--surface);
            box-shadow: var(--shadow-btn);
            transition: all 0.25s ease;
            color: var(--text-light);
        }
        .radio-pill input:checked + label {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            color: white;
            box-shadow: 2px 2px 6px rgba(67,97,238,0.4), -1px -1px 4px rgba(67,97,238,0.15);
        }
        .radio-pill label:hover { transform: translateY(-1px); }

        .mode-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 14px;
        }
        .mode-toggle .radio-pill label { font-size: 12px; padding: 10px 8px; }

        .stepper {
            display: flex;
            align-items: center;
            gap: 0;
            border-radius: var(--radius-xs);
            overflow: hidden;
        }
        .stepper .btn-step {
            width: 36px;
            height: 38px;
            border: none;
            background: var(--surface);
            color: var(--text-main);
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            user-select: none;
            flex-shrink: 0;
            box-shadow: var(--shadow-btn);
        }
        .stepper .btn-step:hover { color: var(--accent); transform: scale(1.05); }
        .stepper .btn-step:active { box-shadow: var(--shadow-btn-press); transform: scale(0.95); }
        .stepper .btn-step.minus { border-radius: var(--radius-xs) 0 0 var(--radius-xs); }
        .stepper .btn-step.plus  { border-radius: 0 var(--radius-xs) var(--radius-xs) 0; }
        .stepper input {
            flex: 1;
            min-width: 0;
            padding: 8px 6px;
            border: none;
            background: var(--surface);
            box-shadow: var(--shadow-in);
            font-size: 13px;
            text-align: right;
            font-family: 'SF Mono', 'Menlo', monospace;
            color: var(--text-main);
            outline: none;
        }
        .stepper input:focus { box-shadow: var(--shadow-in), 0 0 0 2px rgba(67,97,238,0.2); }

        .riders-section { margin-top: 12px; }
        .rider-row {
            display: grid;
            grid-template-columns: 24px 1fr 160px;
            gap: 8px;
            align-items: center;
            padding: 7px 0;
            border-bottom: 1px solid rgba(163,177,198,0.15);
        }
        .rider-row:last-child { border-bottom: none; }
        .rider-row input[type="checkbox"] {
            width: 18px; height: 18px;
            accent-color: var(--accent);
            cursor: pointer;
        }
        .rider-row .rider-name { font-size: 11px; color: var(--text-main); font-weight: 500; }

        .btn-calculate {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 18px;
            transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 4px 4px 10px rgba(67,97,238,0.35), -2px -2px 6px rgba(255,255,255,0.5);
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        .btn-calculate::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 14px rgba(67,97,238,0.4), -3px -3px 8px rgba(255,255,255,0.6);
        }
        .btn-calculate:hover::after { width: 300px; height: 300px; }
        .btn-calculate:active { transform: translateY(0); box-shadow: var(--shadow-btn-press); }
        .btn-calculate:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .panel-right {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 10px;
            margin: -10px;
            padding-bottom: 40px;
        }

        .result-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 18px 20px;
            box-shadow: var(--shadow-out);
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s ease;
            animation: fadeInCard 0.5s ease-out both;
        }
        .result-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); }
        .result-card:nth-child(1) { animation-delay: 0.0s; }
        .result-card:nth-child(2) { animation-delay: 0.08s; }
        .result-card:nth-child(3) { animation-delay: 0.16s; }
        .result-card:nth-child(4) { animation-delay: 0.24s; }
        .result-card:nth-child(5) { animation-delay: 0.32s; }

        @keyframes fadeInCard {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-card h3 {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-card h3 .icon {
            font-size: 18px;
            width: 34px; height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--surface);
            box-shadow: var(--shadow-out-sm);
        }

        .kv-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px;
        }
        .kv-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            border-radius: 8px;
            gap: 8px;
            transition: background 0.2s;
        }
        .kv-row:hover { background: rgba(163,177,198,0.12); }
        .kv-key { font-size: 11px; color: var(--text-light); white-space: nowrap; }
        .kv-val {
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-main);
            white-space: nowrap;
        }

        .highlight-row {
            background: rgba(67,97,238,0.06) !important;
            border-radius: 8px;
            box-shadow: var(--shadow-in);
        }
        .highlight-val { color: var(--accent); font-size: 13px; }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 3px;
            font-size: 11px;
        }
        .data-table th {
            background: linear-gradient(135deg, #3a4a5c, #2d3a4a);
            color: white;
            padding: 8px 10px;
            text-align: right;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .data-table th:first-child { text-align: left; border-radius: 10px 0 0 10px; }
        .data-table th:last-child { border-radius: 0 10px 10px 0; }
        .data-table td {
            padding: 7px 10px;
            text-align: right;
            font-family: 'SF Mono', 'Menlo', monospace;
            font-size: 11px;
            background: var(--surface);
            transition: all 0.2s;
        }
        .data-table td:first-child { text-align: left; border-radius: 8px 0 0 8px; }
        .data-table td:last-child { border-radius: 0 8px 8px 0; }
        .data-table tr:hover td { box-shadow: var(--shadow-in); color: var(--accent); }

        .total-block {
            background: linear-gradient(135deg, #2d3a4a 0%, #1e2a3a 100%);
            color: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 8px 8px 16px rgba(30,42,58,0.4), -4px -4px 12px rgba(255,255,255,0.05);
            animation: fadeInCard 0.5s ease-out both;
            position: relative;
            overflow: hidden;
        }
        .total-block::before {
            content: '';
            position: absolute;
            top: -40%; right: -20%;
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(67,97,238,0.15) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }
        .total-block h3 { color: white; margin-bottom: 12px; position: relative; z-index: 1; }
        .total-block h3 .icon { background: rgba(255,255,255,0.1); box-shadow: none; }

        .total-row {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 16px;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            position: relative;
            z-index: 1;
        }
        .total-row.two-col { grid-template-columns: 1fr auto; }
        .total-row:last-child { border-bottom: none; }
        .total-label { font-size: 13px; opacity: 0.7; }
        .total-sum {
            font-family: 'SF Mono', monospace;
            font-size: 12px;
            opacity: 0.4;
            text-align: right;
            min-width: 80px;
        }
        .total-value {
            font-family: 'SF Mono', monospace;
            font-weight: 700;
            font-size: 14px;
            text-align: right;
            min-width: 80px;
        }
        .total-value.big {
            font-size: 26px;
            background: linear-gradient(135deg, var(--accent-sky), #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(56,189,248,0.3));
        }
        .total-divider {
            border-top: 1px solid rgba(255,255,255,0.12);
            margin: 6px 0;
            position: relative; z-index: 1;
        }
        .total-header-row {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 16px;
            padding: 0 0 6px 0;
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            position: relative; z-index: 1;
        }
        .total-header-row span {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.4;
            font-weight: 600;
        }
        .total-header-row span:nth-child(2),
        .total-header-row span:nth-child(3) { text-align: right; min-width: 80px; }

        .placeholder {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-light);
        }
        .placeholder .icon { font-size: 56px; margin-bottom: 16px; animation: pulseIcon 3s ease-in-out infinite; }
        .placeholder p { font-size: 15px; }
        .placeholder .hint { margin-top: 8px; font-size: 12px; opacity: 0.6; }
        @keyframes pulseIcon {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.08); opacity: 1; }
        }

        .error-box {
            background: rgba(220,38,38,0.06);
            border: none;
            border-radius: var(--radius-xs);
            padding: 14px 18px;
            color: #dc2626;
            font-size: 13px;
            box-shadow: var(--shadow-in);
        }

        .animate-count { display: inline-block; transition: all 0.3s; }
        @keyframes countFlash {
            0% { color: var(--accent); transform: scale(1.12); }
            100% { color: inherit; transform: scale(1); }
        }
        .flash-count { animation: countFlash 0.8s ease-out; }
        .big.flash-count { animation: countFlashBig 1.2s ease-out; }
        @keyframes countFlashBig {
            0% { transform: scale(0.6); opacity: 0; }
            50% { transform: scale(1.08); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes particleBurst {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--px), var(--py)) scale(0); opacity: 0; }
        }
        .particle {
            position: absolute;
            width: 6px; height: 6px;
            border-radius: 50%;
            pointer-events: none;
            animation: particleBurst 0.8s ease-out forwards;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(163,177,198,0.5); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(163,177,198,0.7); }

        @media (max-width: 1024px) {
            .container { grid-template-columns: 1fr; }
            .panel-left { max-height: none; position: static; }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-left">
        <div class="logo-pill">
            <img src="logo.png" alt="Standard Life">
        </div>
    </div>
    <div class="header-right">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ù–°–ñ</h1>
        <div class="subtitle">Pro Life Fit</div>
    </div>
</div>

<div class="container">
    <div class="panel-left">
        <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª–∏—Å–∞</div>

        <div class="form-group">
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="dob" value="1990-05-15">
        </div>

        <div class="form-group">
            <label>–ü–æ–ª</label>
            <div class="radio-group">
                <div class="radio-pill">
                    <input type="radio" name="gender" id="g_male" value="male" checked>
                    <label for="g_male">–ú—É–∂—Å–∫–æ–π</label>
                </div>
                <div class="radio-pill">
                    <input type="radio" name="gender" id="g_female" value="female">
                    <label for="g_female">–ñ–µ–Ω—Å–∫–∏–π</label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–°—Ä–æ–∫ (–ª–µ—Ç)</label>
                <div class="stepper">
                    <div class="btn-step minus" data-target="term" data-step="-1" data-min="3" data-max="20">‚àí</div>
                    <input type="text" id="term" value="10" class="fmt-number" data-step="1" data-min="3" data-max="20">
                    <div class="btn-step plus" data-target="term" data-step="1" data-min="3" data-max="20">+</div>
                </div>
            </div>
            <div class="form-group">
                <label>–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å</label>
                <select id="frequency">
                    <option value="annual" selected>–ì–æ–¥–æ–≤–æ–π</option>
                    <option value="semiannual">–ü–æ–ª—É–≥–æ–¥–æ–≤–æ–π</option>
                    <option value="quarterly">–ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π</option>
                    <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π</option>
                    <option value="single">–ï–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</option>
                </select>
            </div>
        </div>

        <div class="section-title" style="margin-top: 16px;">–†–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞</div>

        <div class="mode-toggle">
            <div class="radio-pill">
                <input type="radio" name="mode" id="mode_sa" value="sa_to_premium" checked>
                <label for="mode_sa">–°–° ‚Üí –ü—Ä–µ–º–∏—è</label>
            </div>
            <div class="radio-pill">
                <input type="radio" name="mode" id="mode_pr" value="premium_to_sa">
                <label for="mode_pr">–ü—Ä–µ–º–∏—è ‚Üí –°–°</label>
            </div>
        </div>

        <div class="form-group" id="sa_group">
            <label>–°—Ç—Ä–∞—Ö–æ–≤–∞—è —Å—É–º–º–∞ (–°–°)</label>
            <div class="stepper">
                <div class="btn-step minus" data-target="sum_assured" data-step="-1000000">‚àí</div>
                <input type="text" id="sum_assured" value="1 000 000" inputmode="numeric" class="fmt-number">
                <div class="btn-step plus" data-target="sum_assured" data-step="1000000">+</div>
            </div>
        </div>

        <div class="form-group" id="pr_group" style="display:none;">
            <label>–ü—Ä–µ–º–∏—è</label>
            <div class="stepper">
                <div class="btn-step minus" data-target="premium" data-step="-10000">‚àí</div>
                <input type="text" id="premium" value="50 000" inputmode="numeric" class="fmt-number">
                <div class="btn-step plus" data-target="premium" data-step="10000">+</div>
            </div>
        </div>

        <div class="section-title" style="margin-top: 16px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è</div>

        <div class="riders-section">
            <div class="rider-row">
                <input type="checkbox" id="r_ad">
                <span class="rider-name">–°–º–µ—Ä—Ç—å –æ—Ç –ù–°</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_ad_sum" data-step="-1000000">‚àí</div>
                    <input type="text" id="r_ad_sum" value="100 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_ad_sum" data-step="1000000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_td">
                <span class="rider-name">–°–º–µ—Ä—Ç—å –≤ –î–¢–ü</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_td_sum" data-step="-1000000">‚àí</div>
                    <input type="text" id="r_td_sum" value="6 000 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_td_sum" data-step="1000000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_dal">
                <span class="rider-name">–ò–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –æ—Ç –ù–°</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_dal_sum" data-step="-500000">‚àí</div>
                    <input type="text" id="r_dal_sum" value="500 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_dal_sum" data-step="500000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_dany">
                <span class="rider-name">–ò–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å (–ª—é–±–∞—è)</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_dany_sum" data-step="-500000">‚àí</div>
                    <input type="text" id="r_dany_sum" value="500 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_dany_sum" data-step="500000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_trauma">
                <span class="rider-name">–¢—Ä–∞–≤–º–∞</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_trauma_sum" data-step="-100000">‚àí</div>
                    <input type="text" id="r_trauma_sum" value="300 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_trauma_sum" data-step="100000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_td2">
                <span class="rider-name">–í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ—Ç—Ä—É–¥–æ—Å–ø–æ—Å.</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_td2_sum" data-step="-100000">‚àí</div>
                    <input type="text" id="r_td2_sum" value="100 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_td2_sum" data-step="100000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_hosp">
                <span class="rider-name">–ì–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_hosp_sum" data-step="-100000">‚àí</div>
                    <input type="text" id="r_hosp_sum" value="50 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_hosp_sum" data-step="100000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_ci">
                <span class="rider-name">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è</span>
                <div class="stepper">
                    <div class="btn-step minus" data-target="r_ci_sum" data-step="-100000">‚àí</div>
                    <input type="text" id="r_ci_sum" value="500 000" inputmode="numeric" class="fmt-number">
                    <div class="btn-step plus" data-target="r_ci_sum" data-step="100000">+</div>
                </div>
            </div>
            <div class="rider-row">
                <input type="checkbox" id="r_pw">
                <span class="rider-name">–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –≤–∑–Ω–æ—Å–æ–≤</span>
                <div style="width:160px; text-align:center; color:var(--text-light); font-size:12px;">‚Äî</div>
            </div>
        </div>

        <button class="btn-calculate" id="btn_calc" onclick="doCalculate()">
            –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
        </button>
    </div>

    <div class="panel-right" id="results">
        <div class="result-card placeholder" id="placeholder">
            <div class="icon">üìä</div>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å¬ª</p>
            <p class="hint">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
        </div>
    </div>
</div>

<script src="engine.js"></script>
<script>
// Mode toggle
document.querySelectorAll('input[name="mode"]').forEach(r => {
    r.addEventListener('change', () => {
        const isSA = r.value === 'sa_to_premium';
        document.getElementById('sa_group').style.display = isSA ? '' : 'none';
        document.getElementById('pr_group').style.display = isSA ? 'none' : '';
    });
});

function fmtS(n) {
    if (n === undefined || n === null) return '‚Äî';
    return Math.round(Number(n)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
}
function fmtRate(n, dec) {
    dec = dec || 6;
    if (n === undefined || n === null) return '‚Äî';
    return Number(n).toFixed(dec);
}
function fmtPct(n) {
    if (n === undefined || n === null) return '‚Äî';
    return (Number(n) * 100).toFixed(2) + '%';
}

const RIDER_LABELS = {
    'accidental_death': '–°–º–µ—Ä—Ç—å –æ—Ç –ù–°',
    'traffic_death': '–°–º–µ—Ä—Ç—å –≤ –î–¢–ü',
    'disability_accident': '–ò–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –æ—Ç –ù–°',
    'disability_any': '–ò–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å (–ª—é–±–∞—è)',
    'trauma': '–¢—Ä–∞–≤–º–∞',
    'temporary_disability': '–í—Ä–µ–º. –Ω–µ—Ç—Ä—É–¥–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å',
    'hospitalization': '–ì–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è',
    'critical_illness': '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è',
    'premium_waiver': '–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –≤–∑–Ω–æ—Å–æ–≤',
};

const FREQ_LABELS = {
    'annual': '–ì–æ–¥–æ–≤–æ–π',
    'semiannual': '–ü–æ–ª—É–≥–æ–¥–æ–≤–æ–π',
    'quarterly': '–ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π',
    'monthly': '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π',
    'single': '–ï–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π',
};

function parseNum(s) {
    if (typeof s === 'number') return s;
    return parseFloat(String(s).replace(/\s/g, '').replace(',', '.')) || 0;
}

function formatInputNum(s) {
    const digits = String(s).replace(/[^\d]/g, '');
    if (!digits) return '';
    return digits.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
}

function animateCountUp(el, targetVal, duration) {
    duration = duration || 800;
    if (isNaN(targetVal) || targetVal === 0) return;
    var startTime = performance.now();
    function update(currentTime) {
        var elapsed = currentTime - startTime;
        var progress = Math.min(elapsed / duration, 1);
        var eased = 1 - Math.pow(1 - progress, 3);
        var current = Math.round(targetVal * eased);
        el.textContent = current.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        if (progress < 1) {
            requestAnimationFrame(update);
        } else {
            el.textContent = fmtS(targetVal);
            el.classList.add('flash-count');
        }
    }
    requestAnimationFrame(update);
}

function spawnParticles(container, count) {
    count = count || 12;
    var colors = ['#4361ee', '#8b5cf6', '#38bdf8', '#10b981', '#f59e0b'];
    for (var i = 0; i < count; i++) {
        var p = document.createElement('div');
        p.className = 'particle';
        p.style.background = colors[i % colors.length];
        var angle = (Math.PI * 2 / count) * i;
        var dist = 40 + Math.random() * 40;
        p.style.setProperty('--px', Math.cos(angle) * dist + 'px');
        p.style.setProperty('--py', Math.sin(angle) * dist + 'px');
        p.style.left = '50%';
        p.style.top = '50%';
        container.appendChild(p);
        setTimeout(function(el){ el.remove(); }, 900, p);
    }
}

function doCalculate() {
    var btn = document.getElementById('btn_calc');
    btn.disabled = true;
    btn.textContent = '–†–∞—Å—á—ë—Ç...';

    var mode = document.querySelector('input[name="mode"]:checked').value;
    var gender = document.querySelector('input[name="gender"]:checked').value;

    var params = {
        dob: document.getElementById('dob').value,
        gender: gender,
        term: parseInt(parseNum(document.getElementById('term').value)),
        frequency: document.getElementById('frequency').value,
        mode: mode,
    };

    if (mode === 'sa_to_premium') {
        params.sum_assured = parseNum(document.getElementById('sum_assured').value);
    } else {
        params.premium = parseNum(document.getElementById('premium').value);
    }

    params.riders = {};
    var riderMap = [
        ['r_ad', 'r_ad_sum', 'accidental_death'],
        ['r_td', 'r_td_sum', 'traffic_death'],
        ['r_dal', 'r_dal_sum', 'disability_accident'],
        ['r_dany', 'r_dany_sum', 'disability_any'],
        ['r_trauma', 'r_trauma_sum', 'trauma'],
        ['r_td2', 'r_td2_sum', 'temporary_disability'],
        ['r_hosp', 'r_hosp_sum', 'hospitalization'],
        ['r_ci', 'r_ci_sum', 'critical_illness'],
        ['r_pw', null, 'premium_waiver'],
    ];

    riderMap.forEach(function(item) {
        var cbId = item[0], sumId = item[1], key = item[2];
        var cb = document.getElementById(cbId);
        if (cb.checked) {
            var entry = { enabled: true };
            if (sumId) entry.sum = parseNum(document.getElementById(sumId).value);
            params.riders[key] = entry;
        }
    });

    try {
        var data = NSJEngine.calculate(params);
        renderResults(data);
    } catch (e) {
        renderError(e.message);
    } finally {
        btn.disabled = false;
        btn.textContent = '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å';
    }
}

function renderError(msg) {
    var panel = document.getElementById('results');
    panel.innerHTML = '<div class="result-card"><div class="error-box"><strong>–û—à–∏–±–∫–∞:</strong> ' + msg + '</div></div>';
}

function buildTotalRiders(d) {
    if (!d.riders || Object.keys(d.riders).length === 0) return '';
    var html = '';
    for (var key in d.riders) {
        var r = d.riders[key];
        var label = RIDER_LABELS[key] || key;
        var prem = r.premium || r.annual || 0;
        if (prem === 0) continue;
        var rsum = r.rider_sum || r.ci_sum || 0;
        html += '<div class="total-row">' +
            '<span class="total-label" style="font-size:12px;">' + label + '</span>' +
            '<span class="total-sum">' + (rsum > 0 ? fmtS(rsum) : '‚Äî') + '</span>' +
            '<span class="total-value" style="font-size:13px;">' + fmtS(prem) + '</span>' +
            '</div>';
    }
    return html;
}

function renderResults(d) {
    var panel = document.getElementById('results');
    var freq = d.frequency;

    // Riders table
    var ridersRows = '';
    if (d.riders && Object.keys(d.riders).length > 0) {
        for (var key in d.riders) {
            var r = d.riders[key];
            var label = RIDER_LABELS[key] || key;
            var tariff = r.gross_tariff ? fmtRate(r.gross_tariff, 4) : (r.BP ? fmtRate(r.BP, 4) : '‚Äî');
            var prem = r.premium || r.annual || 0;
            ridersRows += '<tr>' +
                '<td style="text-align:left">' + label + '</td>' +
                '<td>' + tariff + '</td>' +
                '<td>' + fmtS(prem) + '</td>' +
                '</tr>';
        }
    }

    // Reserves table
    var reservesRows = '';
    if (d.reserves) {
        d.reserves.forEach(function(r) {
            reservesRows += '<tr>' +
                '<td style="text-align:left">' + r.year + '</td>' +
                '<td>' + (d.age + r.year) + '</td>' +
                '<td>' + fmtS(r.reserve) + '</td>' +
                '<td>' + fmtS(r.surrender) + '</td>' +
                '</tr>';
        });
    }

    panel.innerHTML =
        // Main results
        '<div class="result-card">' +
            '<h3><span class="icon">üìã</span> –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>' +
            '<div class="kv-grid">' +
                '<div class="kv-row"><span class="kv-key">–í–æ–∑—Ä–∞—Å—Ç</span><span class="kv-val">' + d.age + '</span></div>' +
                '<div class="kv-row"><span class="kv-key">–°—Ä–æ–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è</span><span class="kv-val">' + d.term + ' –ª–µ—Ç</span></div>' +
                '<div class="kv-row"><span class="kv-key">–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å</span><span class="kv-val">' + (FREQ_LABELS[freq] || freq) + '</span></div>' +
                '<div class="kv-row highlight-row"><span class="kv-key"><strong>–°—Ç—Ä–∞—Ö–æ–≤–∞—è —Å—É–º–º–∞</strong></span><span class="kv-val highlight-val animate-count" data-target="' + Math.round(d.sum_assured) + '">' + fmtS(d.sum_assured) + '</span></div>' +
                '<div class="kv-row highlight-row"><span class="kv-key"><strong>–ì–æ–¥–æ–≤–∞—è –ø—Ä–µ–º–∏—è</strong></span><span class="kv-val highlight-val animate-count" data-target="' + Math.round(d.annual_premium) + '">' + fmtS(d.annual_premium) + '</span></div>' +
                '<div class="kv-row highlight-row"><span class="kv-key"><strong>–ü—Ä–µ–º–∏—è (' + (FREQ_LABELS[freq] || freq) + ')</strong></span><span class="kv-val highlight-val animate-count" data-target="' + Math.round(d.gross_premium) + '">' + fmtS(d.gross_premium) + '</span></div>' +
            '</div>' +
        '</div>' +

        // Riders
        (ridersRows ? '<div class="result-card">' +
            '<h3><span class="icon">üõ°Ô∏è</span> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è</h3>' +
            '<table class="data-table"><thead><tr>' +
                '<th>–ü–æ–∫—Ä—ã—Ç–∏–µ</th><th>–¢–∞—Ä–∏—Ñ</th><th>–ü—Ä–µ–º–∏—è</th>' +
            '</tr></thead><tbody>' + ridersRows + '</tbody></table>' +
        '</div>' : '') +

        // Total
        '<div class="total-block" id="total-block">' +
            '<h3><span class="icon">üí∞</span> –ò—Ç–æ–≥–æ</h3>' +
            '<div class="total-header-row"><span>–ü–æ–∫—Ä—ã—Ç–∏–µ</span><span>–°—Ç—Ä–∞—Ö. —Å—É–º–º–∞</span><span>–ü—Ä–µ–º–∏—è</span></div>' +
            '<div class="total-row"><span class="total-label">–û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ</span><span class="total-sum">' + fmtS(d.sum_assured) + '</span><span class="total-value animate-count" data-target="' + Math.round(d.gross_premium) + '">' + fmtS(d.gross_premium) + '</span></div>' +
            buildTotalRiders(d) +
            '<div class="total-divider"></div>' +
            '<div class="total-row two-col" style="padding-top:12px;margin-top:4px;">' +
                '<span class="total-label" style="font-size:16px;font-weight:700;opacity:1;">–ò–¢–û–ì–û –ü–†–ï–ú–ò–Ø</span>' +
                '<span class="total-value big animate-count" data-target="' + Math.round(d.total_premium) + '" id="total-premium-val">' + fmtS(d.total_premium) + '</span>' +
            '</div>' +
        '</div>' +

        // Reserves
        (reservesRows ? '<div class="result-card">' +
            '<h3><span class="icon">üìä</span> –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑–µ—Ä–≤–æ–≤ –∏ –≤—ã–∫—É–ø–Ω—ã—Ö —Å—É–º–º</h3>' +
            '<div style="overflow-x:auto;"><table class="data-table"><thead><tr>' +
                '<th>–ì–æ–¥</th><th>–í–æ–∑—Ä–∞—Å—Ç</th><th>–†–µ–∑–µ—Ä–≤</th><th>–í—ã–∫—É–ø–Ω–∞—è</th>' +
            '</tr></thead><tbody>' + reservesRows + '</tbody></table></div>' +
        '</div>' : '');

    // Animations
    setTimeout(function() {
        document.querySelectorAll('.animate-count').forEach(function(el) {
            var target = parseInt(el.dataset.target);
            if (target && target > 0) {
                animateCountUp(el, target, el.classList.contains('big') ? 1200 : 800);
            }
        });
        var totalBlock = document.getElementById('total-block');
        if (totalBlock) {
            setTimeout(function() { spawnParticles(totalBlock, 16); }, 600);
        }
    }, 100);
}

// Stepper buttons
document.querySelectorAll('.btn-step').forEach(function(btn) {
    btn.addEventListener('click', function() {
        var targetId = btn.dataset.target;
        var input = document.getElementById(targetId);
        var step = parseInt(btn.dataset.step);
        var min = parseInt(btn.dataset.min) || 0;
        var max = parseInt(btn.dataset.max) || 999999999;
        var val = parseNum(input.value) + step;
        val = Math.max(min, Math.min(max, val));
        input.value = formatInputNum(String(val));
    });
});

// Auto-format number inputs
document.querySelectorAll('.fmt-number').forEach(function(el) {
    el.addEventListener('blur', function() {
        el.value = formatInputNum(el.value);
    });
    el.addEventListener('input', function() {
        var pos = el.selectionStart;
        var oldLen = el.value.length;
        var raw = el.value.replace(/[^\d]/g, '');
        el.value = formatInputNum(raw);
        var newLen = el.value.length;
        var newPos = pos + (newLen - oldLen);
        el.setSelectionRange(newPos, newPos);
    });
});

// Auto-calculate on Enter
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !document.getElementById('btn_calc').disabled) {
        doCalculate();
    }
});
</script>

</body>
</html>
